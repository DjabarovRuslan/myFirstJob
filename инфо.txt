---------------------------------js------------------------------------
jquery.highlight.js - подсветка найденного в поиске
var search - переменная исп- ся для подсветки найденного в поиске в методе "highlight"


----------------------------------------------------------------------------


все что в меню - это категории!!
при нажатии на рездел категории  выводятся товары этой категории 
принцип вывода страниц:
сайт подходит для вывода товаров ,при нажатии на любой пункт меню(т.е.категорию) выводятся все  товары дочерних категорий !!органичиваем кол -во вывода товаров на странице плюс пагинация  вот и весь смысл пока на этот момент!!


1БД:в БД 3 таблицы 
!categories:состоит id,title,parent!!!!в id --идентификаторы,title - название категорий,
в parent-указаны  id род.категории!!

!pages - для меню (Главная  О компании Контакты)
!products 
!forgot-  для восс пароля 
!options - опции для админки
2 меню:
ф- ия  get_cat() достает все из табл categories и выводит в виде массивов ,где ключами каждого массива являются id каждой категории!!ф- ия map_tree($dataset) создает дерево категорий в виде потомков!!с помощью categories_to_string($categories_tree) и плагина jquery выводит пункты меню

 3 хлебные крошки:
 ф- ия breadcrumbs($array, $id) возвращает массив родителей в виде  ([685] => Комплектующие к Apple)и выводит
  !!!в catalog.php изменил(по ходу урока) получение $id,в зависимости куда нажал польз категория ил товар находится соответствующее значение $id


 4 вывод товаров: function cats_id($array, $id) выводит ID дочерних категорий нажатого пункта меню или хлебных крошек в виде ( 691,695,696,697,698,699,692,700,701,)!!!это список категорийи в каждой из них товары!!чтоб ограничить бесконечный вывод товаров устанавливем ограничение на количество вывода товара на страницу при помощи $perpage также устанавливаем переменную $start_pos ($start_pos = ($page - 1) * $perpage) ,она указыват с какой позиции доствать из БД записи

 ф- ия get_products($ids, $start_pos, $perpage) получает на входе все эти данные и выводит на экран

 3 Пагинация : вроде все понятно

 4 ЧПУ:
 в файле .htaccess заменяем при помощи регулярных выражений что на что менять (у меня не работает,может настрой ки опен сервера моего ???) 

 RewriteRule ^product/(\d+)/?$ product.php?product=$1

   означает:все что идет после product/т.е.(\d+)- любые числа , а скобка его делает запоминающей ся переменной $1(если будет еще какое то выражение  в скобках после этой скобки то она превратится $2)!!
   ^ - (как я понял) перед product ничего не должно быть ,т.е.сразу после корневого каталога должен идти product
   $ - символ конца строки (ничего не должно быть после)
   ?- означает что перед ним может быть / может и не быть
 

 /-----------------------------------------------------------------------------
для ЧПУ с алиасами в БД создали столбец alias для product и заполнили с лат переводом...!!столбец alias присвоили(для быстой работы mysql) ключ уникальный(id -первичный),при этом одинаковых алиасов не должно быть ,но временоо исправили  одинаковые записи для работы .
!!!так же проделаю для categories

 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
 урок 10 ЧПУ роутинг переделываю в MVC (модель вид контроллер) в данный момент 
 вид: index.php и product.php и category_template.php
 модель: functions.php
 контроллер : catalog.php
 переименуем catalog.php в index.php и останится он контроллером

 define("RUSLAN", TRUE) константа вводится чтоб запретить доступ к файлам или каталогам напрямую с адр строки в кот может войти пользователь  ведь .htaccess условия: 
 RewriteCond %{REQUEST_FILENAME} !-f
 RewriteCond %{REQUEST_FILENAME} !-d
 RewriteRule .* index.php
позволяют это сделать !!!поэтому файлы проходят условие 
<?php defined("RUSLAN") or die("тебе сюда нельзя!!!");?>
а в индексном файле мы   объявляем define("RUSLAN", TRUE),в теле индексного файла  подключаем файлы(к которым мы устанавливали запрет) при помощи например
include "views/{$view}.php", и эти файлы становятся частью индексного файла
т.е. условие  defined("RUSLAN") or die("тебе сюда нельзя!!!") на них не действует
!!!!ИДЕЯ!!доступ ко всем файлам только через index.php
---------------------------коментарии--------------------------
создаем табицу comment c полями:
1 comment_id - номер комента
2 comment_author  - автор комента
3 comment_text - текст комента 
4 parent - id родительского комента(по умолчанию равен 0)..независимый комент(если parent_id = 2, то это  ответ на комент у кот comment_id = 2  )
5 comment_product - id (alias) продукта ,к которому относится комент
6 approved(одобренный)- модерация комента ...(матерщина)
7 created - дата создания комента
8 is_admin - принадлежность комента администрации

коменты привязаны к id товара т.е польз просм -ет товар то выводим все коменты к этому товару!!получаем id товара в controller_product.php

jquery-ui-1.10.3.custom.min.js - нужен для модального окна ввода сообщения
view/css здесь тема из jquery-ui
!!!добавление комментариев:исп.виджет dialog из jquery-ui для модального окна,в скрипте на странице view_product.php описываем:
1  кнопке "Добавить комментарий" и  ссылке "ответить"(находится внутри комментариев) задаем класс "open-form" и вешаем на них событие ,при клике выводить окно ввода комментария




------------------------------------------------------------------------
!!!$_SESSION['auth']['user'] признак авторизованного пользователя
авторизация (controller_login.php) и выход (controller_logout.php) все понятно

-----(забыл пароль)controller_forgot.php -----------------------------------!!
 кнопка забыль пароль  срабатывает через  JS (workscripts.js)
принцип:через форму <form action="<?=PATH?>forgot" method="post"> отпрвляет на контроллер forgot и заполняем таблицу forgot в БД,где hash- случ. генерир строка ,кот-ая в виде ссылки отправл на почту пользователя,expire - время действия ссылки ( у нас 1 час) id, email понятно 

    ------------------------регистрация controller_reg.php -------------------------------
    чтоб не было 2 одинаковых значения логин и почта делаем уникальными за счет базы данных прописывая значение уникум в каждой колонке за счет индекса уникум

    data-field="login" и data-field="email" вводим новые атрибуты в inputы в форме регистрации в кот будут хранится введеные польз login и email,в остальных инпутах они не нужны потому что login и email проверяем на уникальность через ajax...также добавляем класс "access" этим инпутам нажатие на кот запускает JS (активвируются иконки и проверка)
    !!скрипты регистрации в шаблоне apple подключаются в view_footer.php ,тело скрипта находится в scripts.js.
     !!!!в view_footer.php объявлена и переменная path (<script > var path = "<?=PATH?>"</script> ), это путь для js скриптов(исп внутри js кода )

    ------------------живой поиск ----------------------------------------
   используем билиотеку jqueryui и плагин   
Autocomplete.!!!!в scripts.js заполняем параметры : 


 $('#autocomplete').autocomplete({ -  (подкл для id(инпут формы в view_header.php))
    source: 'http://ruslan/search/', -  (путь к обработчику)
    minLength: 1,  -                 (с какой буквы начнем отправку запоса)
    select: function( event, ui ){ ()
      console.log(ui);
    }
  });
 event - событие(см. документацию jqueryui плагин autocomplete)
  ui -   метод (см. документацию jqueryui плагин autocomplete)


    --------------------------------------------------------------------------
    куки (чекбокс запомнить меня )

    принцип :если польз нажал "запомнить " в авторизации создается кука и прописывается в браузере поль-ля и  на сервере в БД  в табл users в  поле remember..,если поль- ль закрыл браузер (не нажав выход) , то кука живет согласно сроку и в ББД и у поль- ля , как только поль-ль нажмет выход то кука удаляется и в БД и у пользователя


    ______________________________________________________________________________
                captcha
        
        captcha.php находится в libs/captcha/captcha.php

                
      исп- ся на странице регистрации (view_reg.php)!!!как работает :создаем папку captcha в папке libs!!в <img src="<?=PATH?>libs/captcha/captcha.php" (view_reg.php)

      прописываем путь до скрипта (captcha.php)

      !!<span style="cursor: pointer; color: #ff0000;" onclick="document.getElementById('captcha').src = '<?=PATH?>libs/captcha/captcha.php?' + Math.random()">Обновить</span>       
       !!! часть из view_reg.php из формы  отвечеает за обновление каптчи(через JS запускаем скрипт рhp?кот обновляет каптчу)

       !! + Math.random() (добавляем GET параметр)исп- ся чтоб обойти кэширование каптчи браузером,т.е
       без + Math.random(),после обновления страницы обновляется и каптча и если нажать на кнопку "обновить", то каптча не обновляется ,это связано с кэшированием этой каптчи браузером,чтоб избежать этого мы и используем+ Math.random()(пока не понятно,разобраться) 

       ------------------------------------------------------------------------
                                      админка
        табл options - опции для админки
        !!в роутингах админки 2 (пока) позиции login для авторизации и options для изменений "нужных"" параметров сайта из табл options
        !!в view_footer.php(админки) создали 2 ДИВа :
        1  <div id="mes-edit">- для вывода ответов ,в нем 2 spana :1 для сообщения , 2- span для крестика(закрыть сообщение)
        2 <div id="loader"><span></span></div> - для вывод картинки загрузки

        !!!в scripts.js(админки ) описываем события(для крестика ..т.д)


       !!!методы POST (в ajax ,в контроллере (удалении товара ,в изменение цены) ) переделаны под метод GET чтоб не конфликтовали!стали $_GET['title'] были $_POST['title'],переделали потому что этот $_POST['title'] используется в редактировании товара (не в удалении товара ,не в  изменение цены)!!как я понял изменили чтоб в некоторых контроллерах не конфликтовали 

    --------------- описание scripts.js из админки----------------------------------

    $(function(){
// крестик для сообщений(из view_footer.php)
//при нажатиии на крестик (.cross-times)
   $('.cross-times').on('click', function(){
//  скрыть <div id="mes-edit">
    $('#mes-edit').hide();
    //удаляем содержимое  span (.responce)
    $('#mes-edit .responce').empty();
  });


     // конец крестик для сообщений 


 //в админке настройка сайта выглядет как "курс" и его значение "23"!!ниже часть кода для изменения значений!!!
 !!события для инпутов ("23","admin@catalog.loc"),
     т.к.эти инпуты имеют class edit(view_options.php):


  $('.edit').each(function(){
  //выше:берем поле с классом edit и проходимся в цикле:пройдем по всем полям
  //ниже:если произошло событие change(изм - ие поля)
    $(this).change(function(){
//ниже:берем значение элемента ,который изменился
      var val = $(this).val();
//ниже:у измененого поля достаем "название поля" ,он находится в инпуте(view_options.php) в name( у "23" это "course") 
      var title = $(this).attr('name');
 //  ниже:адрес куда мы отправляем запрос,т.е.к родителю с классом  ".zebra"  и его атрибуту data(data-table="")(не понятно )(см.view_options.php)
   атрибут data-table=""  нужен как адрес на кот  будем отпрвлять данные!!
    !!не понятно почему он пуст??в скрипте он указан кук путь url!!и автор говорит раз этот путь указан ,значит попадет на этот контроллер (controller_options.php)   см. scripts.js-->//

      var url = $(this).parents('.zebra').data('table');
      console.log(val);
      console.log(title);
//после изменения значения какого нибудь поля отправляем данные при помощи след ф-ии:
      updateField(val, title, url);
    });
  });

  function updateField(val, title, url){
    if( !url ) url = '';
    $.ajax({
      url: path + url,
      type: 'GET',
      data: {val: val, title: title},
  //перед отправкой запроса "показать " loader
      beforeSend : function(){
        $('#loader').fadeIn();
      },
      success: function(res){
        $('#mes-edit .responce').text(res);
  //сам div c классом '#mes-edit' показать
        $('#mes-edit').delay(500).fadeIn(1000);
      },
      error: function(){
        alert('Ошибка!');
      },
      complete: function(){
        $('#loader').delay(500).fadeOut();
      }
    });
  }

});


!!!!визуальный редактор ckeditor используем для ввода "описания" товара в админской части на странице редактирования товара с кнопкой "изменить".загрузка изображения в этом редакторе нет (есть ссылка на путь картинки для показа ,хотелось бы встроить возможность загружать изображение),поэтому и воспользуемся файловым менеджером CKFinder(скачал у автора)
!!!для картинок загружаемых при помощи CKFinder создаем папку upload(в папке userfiles)
!!если на реальном сервере (для linux) надо разрешить запись в эту папку,т.е. права должны быть "777"(chmod - 0777) (переписал все это из док- ии CKFinder),для  windows этого делать не нужно (интеграция в ckeditor просто жопа для меня ,скпировал у автора)
!!!какая то проблема с кеширование(пока не пойму) 
!!О КЭШИРОВАНИИ:CKFinder интегрируется в ckeditor,если все норм то   в пункте "изображение" появляется кнопка "загрузить",если этой кнопка не появляется то CKFinder или не  работает или проблема с КЭшированием поэтому в firefox в настройках поставил галочку "отключить http кеш(когда открыта панель инструментов)",также кэширование (как я понял) не работает  когда открывается консоль(инструменты разр) и делается перезагрузка страницы(ни куя не понятно)
!!в папке views/CKFinder/conf/config.php  меняются обшие настройки,
!!!в  views/CKFinder в папке browse.php  мы вставили условие доступа к работе CKFinder если не админ
!!!через CKFinder мы добавляем дополнительны картинки к товару ,а главное изображение остается(как его менять ) пока не понятно
  

  --------------мета данные -----------------------------------

  для метаданных продукта создали  в БД в таблице products 3 поля (m_title ,m_desc ,m_keys )и в редактировании товара в админке их вводим ,для категорий ,для других страниц делается аналогично СДЕЛАТЬ САМОМУ
  !!автор их в курсе не выводит (гандон),дает посказку чтоб сделали сами :при обращении к тому или иному контроллеру (надо создать например ф- ию set_meta() в общей models),при получении данных товара или категории метаданные собрать в массиви еще создать  ф- ию которая будет получать эти данные (напр get_meta() в общей модели),которая будет создавать тег<meta>и т.д и вставлять эти метаданные


  !!!автор реализовал метаданные(хотя не хотел см. выше)


  ------------загрузка картинок перетаскиванием в админке---------------
  dropzone используем для загруки 
  !! в файле dropzone.css класс dropzone переименовали в upload(не пойму для чего)
  !!описание ф- ии из scripts.js(см.документацию )

!!div#upload из view_edit_product.php
  var myDropzone = new Dropzone('div#upload', {
      paramName: "file",
        url: path + "upload",
        maxFiles: 1,
        success: function (file, responce) {
            console.log(file);
            console.log(responce);
        },
        init: function(){
            $(this.element).html(this.options.dictDefaultMessage);
        },
        processing: function()
        {
            $('.dz-message').remove();
        },
        dictDefaultMessage: '<div class="dz-message">Нажмите здесь или перетащите сюда файлы для загрузки</div>',
        dictMaxFilesExceeded: 'Достигнут лимит загрузки файлов - разрешено {{maxFiles}}'
    });
ни куя не понятно  с загрузкой картинок

    ------------совет для "добавить товар"--------------------------
  (как я понял)  картинку для товара нужно вводить в БД после того как ввел сам товар.связано с id ,картинку привязать к id товара (как то так пока не понял)